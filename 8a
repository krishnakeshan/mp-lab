DELAY MACRO
LOCAL D1,D2
PUSH BX
PUSH CX
MOV BX,5000
D1:MOV CX,0FFFFH
D2:LOOP D2
DEC BX
JNZ D1
POP CX
POP BX
ENDM

.MODEL SMALL
.STACK
.DATA
PORTA EQU 0E880H
PORTB EQU 0E881H
PORTC EQU 0E882H
CTRL EQU 0E883H
.CODE
MOV AX,@DATA
MOV DS,AX
MOV AL,82H
MOV DX,CTRL
OUT DX,AL
L1:CALL UP
   CALL DOWN
   JMP L1
STOP:MOV AH,4CH
INT 21H

UP PROC NEAR
MOV AL,0
L2:MOV DX,PORTA
   OUT DX,AL
   PUSH AX
   MOV AH,0BH
   INT 21H
   OR AL,AL
   JNZ STOP
    DELAY
    POP AX
    INC AL
    CMP AL,99
    JNZ L2
    RET
    UP ENDP

DOWN PROC NEAR
MOV AL,99
L3:MOV DX,PORTA
   OUT DX,AL
   PUSH AX
   MOV AH,0BH
   INT 21H
   OR AL,AL
   JNZ STOP
    DELAY
    POP AX
    DEC AL
    CMP AL,100
    JNZ L3
    RET
    DOWN ENDP
END
